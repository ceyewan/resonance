# Resonance IM ä¼˜åŒ–æ–¹æ¡ˆæ€»è§ˆ

> æœ¬æ–‡æ¡£æ±‡æ€»äº† Resonance IM ç³»ç»Ÿçš„æ‰€æœ‰ä¼˜åŒ–æ–¹æ¡ˆï¼Œä»¥ Issue å½¢å¼ç»„ç»‡ï¼Œä¾¿äºå¼€å‘å’Œè·Ÿè¸ªã€‚

---

## ğŸ“‹ æ–‡æ¡£ç´¢å¼•

### ä¸€ã€æœåŠ¡æ²»ç† (Governance)

| Issue ID | æ–‡æ¡£ | åŠŸèƒ½ | ä¼˜å…ˆçº§ | çŠ¶æ€ |
|----------|------|------|--------|------|
| GOV-001 | [governance-metrics.md](./governance-metrics.md) | Prometheus æŒ‡æ ‡é‡‡é›† | P0 | å¾…å¼€å‘ |
| GOV-002 | [governance-tracing.md](./governance-tracing.md) | åˆ†å¸ƒå¼é“¾è·¯è¿½è¸ª | P1 | å¾…å¼€å‘ |
| GOV-003 | [governance-graceful-shutdown.md](./governance-graceful-shutdown.md) | ä¼˜é›…å…³é—­ | P1 | å¾…å¼€å‘ |
| GOV-004 | [governance-health-check.md](./governance-health-check.md) | å¥åº·æ£€æŸ¥ | P1 | å¾…å¼€å‘ |
| GOV-005 | [governance-ratelimit.md](./governance-ratelimit.md) | RPC é™æµ | P1 | å¾…å¼€å‘ |
| GOV-006 | governance-circuit-breaker.md | ç†”æ–­å™¨æ¥å…¥ | P1 | å¾…è§„åˆ’ |
| GOV-007 | governance-mq-monitor.md | MQ ç›‘æ§å‘Šè­¦ | P2 | å¾…è§„åˆ’ |

### äºŒã€åŠŸèƒ½å¢å¼º (Feature)

| Issue ID | æ–‡æ¡£ | åŠŸèƒ½ | ä¼˜å…ˆçº§ | çŠ¶æ€ |
|----------|------|------|--------|------|
| FEAT-001 | [feature-unread-count.md](./feature-unread-count.md) | æœªè¯»æ¶ˆæ¯è®¡æ•° | P0 | å¾…å¼€å‘ |
| FEAT-002 | [feature-message-history.md](./feature-message-history.md) | æ¶ˆæ¯å†å²æ‹‰å– | P0 | å¾…å¼€å‘ |
| FEAT-003 | feature-read-receipt.md | æ¶ˆæ¯å·²è¯»å›æ‰§ | P1 | å¾…è§„åˆ’ |
| FEAT-004 | feature-message-recall.md | æ¶ˆæ¯æ’¤å› | P1 | å¾…è§„åˆ’ |
| FEAT-005 | feature-message-search.md | æ¶ˆæ¯æœç´¢ | P1 | å¾…è§„åˆ’ |
| FEAT-006 | feature-file-transfer.md | æ–‡ä»¶ä¼ è¾“ | P2 | å¾…è§„åˆ’ |
| FEAT-007 | feature-mention.md | @æåŠåŠŸèƒ½ | P2 | å¾…è§„åˆ’ |

### ä¸‰ã€æ€§èƒ½ä¼˜åŒ– (Performance)

| Issue ID | æ–‡æ¡£ | ä¼˜åŒ–ç‚¹ | ä¼˜å…ˆçº§ | çŠ¶æ€ |
|----------|------|--------|--------|------|
| PERF-001 | inbox-optimization.md | Inbox è¡¨é‡æ„ | P1 | å¾…è§„åˆ’ |
| PERF-002 | perf-session-cache.md | ä¼šè¯åˆ—è¡¨ç¼“å­˜ | P1 | å¾…è§„åˆ’ |
| PERF-003 | perf-batch-push.md | æ‰¹é‡æ¨é€ä¼˜åŒ– | P1 | å¾…è§„åˆ’ |
| PERF-004 | perf-message-storage.md | æ¶ˆæ¯å­˜å‚¨åˆ†å±‚ | P2 | å¾…è§„åˆ’ |
| PERF-005 | perf-db-optimization.md | æ•°æ®åº“ä¼˜åŒ– | P2 | å¾…è§„åˆ’ |

---

## ğŸ¯ å®æ–½è·¯çº¿å›¾

### Phase 1: å¯è§‚æµ‹æ€§ä¸ç¨³å®šæ€§ (Week 1-2)

**ç›®æ ‡**ï¼šå»ºç«‹ç›‘æ§å‘Šè­¦ï¼Œæå‡ç³»ç»Ÿå¯è§‚æµ‹æ€§

- [ ] **GOV-001**: Prometheus æŒ‡æ ‡é‡‡é›†
- [ ] **GOV-004**: å¥åº·æ£€æŸ¥æœºåˆ¶
- [ ] **GOV-003**: ä¼˜é›…å…³é—­

**é¢„æœŸæ”¶ç›Š**ï¼š
- æ•…éšœå¯åŠæ—¶å‘ç°
- æœåŠ¡éƒ¨ç½²æ›´å¹³æ»‘
- é—®é¢˜å®šä½æ•ˆç‡æå‡

---

### Phase 2: æ ¸å¿ƒåŠŸèƒ½è¡¥å…¨ (Week 3-4)

**ç›®æ ‡**ï¼šè¡¥é½æ ¸å¿ƒ IM åŠŸèƒ½

- [ ] **FEAT-001**: æœªè¯»æ¶ˆæ¯è®¡æ•°
- [ ] **FEAT-002**: æ¶ˆæ¯å†å²æ‹‰å–
- [ ] **GOV-005**: RPC é™æµä¿æŠ¤

**é¢„æœŸæ”¶ç›Š**ï¼š
- ç”¨æˆ·ä½“éªŒæ˜¾è‘—æå‡
- æœåŠ¡ç¨³å®šæ€§å¢å¼º

---

### Phase 3: è¿›é˜¶åŠŸèƒ½ä¸æ€§èƒ½ (Week 5-8)

**ç›®æ ‡**ï¼šå®Œå–„é«˜çº§åŠŸèƒ½ï¼Œä¼˜åŒ–æ€§èƒ½

- [ ] **GOV-002**: åˆ†å¸ƒå¼é“¾è·¯è¿½è¸ª
- [ ] **FEAT-003**: æ¶ˆæ¯å·²è¯»å›æ‰§
- [ ] **FEAT-004**: æ¶ˆæ¯æ’¤å›
- [ ] **PERF-001**: Inbox è¡¨é‡æ„
- [ ] **PERF-002**: ä¼šè¯åˆ—è¡¨ç¼“å­˜

**é¢„æœŸæ”¶ç›Š**ï¼š
- åŠŸèƒ½å®Œæ•´åº¦è¾¾åˆ°ä¸»æµ IM æ°´å¹³
- æ€§èƒ½æå‡ 3-5 å€

---

### Phase 4: é«˜çº§ä¼˜åŒ– (Week 9+)

**ç›®æ ‡**ï¼šæŒç»­ä¼˜åŒ–å’Œæ‰©å±•

- [ ] **FEAT-005**: æ¶ˆæ¯æœç´¢
- [ ] **GOV-006**: ç†”æ–­å™¨æ¥å…¥
- [ ] **PERF-003**: æ‰¹é‡æ¨é€ä¼˜åŒ–

---

## ğŸ“Š å…³é”®æŒ‡æ ‡å¯¹æ¯”

### ä¼˜åŒ–å‰ vs ä¼˜åŒ–å

| æŒ‡æ ‡ | ä¼˜åŒ–å‰ | ä¼˜åŒ–å | æå‡ |
|------|--------|--------|------|
| **ä¼šè¯åˆ—è¡¨å“åº”æ—¶é—´ (P99)** | 200-500ms | 10-50ms | â¬‡ï¸ 80% |
| **æ¶ˆæ¯å‘é€ QPS** | ~500 | >5000 | â¬†ï¸ 10x |
| **æ•°æ®åº“æŸ¥è¯¢ QPS** | ~2000 | ~500 | â¬‡ï¸ 75% |
| **ç¼“å­˜å‘½ä¸­ç‡** | 0% | >90% | â¬†ï¸ 90% |
| **æ•…éšœæ¢å¤æ—¶é—´** | 5-10min | <1min | â¬‡ï¸ 80% |
| **ç³»ç»Ÿå¯ç”¨æ€§** | 99.5% | 99.9% | â¬†ï¸ 0.4% |

---

## ğŸ› ï¸ æŠ€æœ¯æ ˆè¡¥å……

### æ–°å¢ç»„ä»¶

| ç»„ä»¶ | ç”¨é€” | ç‰ˆæœ¬ | ç›¸å…³ Issue |
|------|------|------|-----------|
| **Prometheus** | ç›‘æ§æŒ‡æ ‡ | 2.x | GOV-001 |
| **Jaeger** | é“¾è·¯è¿½è¸ª | Latest | GOV-002 |
| **Elasticsearch** | æ¶ˆæ¯æœç´¢ | 7.x | FEAT-005 |

### Genesis ç»„ä»¶å¯ç”¨è®¡åˆ’

| ç»„ä»¶ | å½“å‰çŠ¶æ€ | å¯ç”¨è®¡åˆ’ | ç›¸å…³ Issue |
|------|----------|----------|-----------|
| `breaker` | âš ï¸ å·²é¢„ç•™ | Phase 4 | GOV-006 |
| `ratelimit` | âœ… éƒ¨åˆ†å¯ç”¨ | Phase 2 | GOV-005 |
| `metrics` | âœ… å·²å¯ç”¨ | Phase 1 | GOV-001 |
| `cache` | âœ… å·²å¯ç”¨ | Phase 3 | PERF-002 |

---

## ğŸ“ å¼€å‘è§„èŒƒ

### åˆ†æ”¯å‘½å

```
governance/<æ²»ç†ç‚¹>    # æœåŠ¡æ²»ç†
feature/<åŠŸèƒ½å>       # æ–°åŠŸèƒ½å¼€å‘
perf/<ä¼˜åŒ–ç‚¹>          # æ€§èƒ½ä¼˜åŒ–
fix/<é—®é¢˜æè¿°>         # Bug ä¿®å¤
```

### æäº¤è§„èŒƒ

```
<type>(<scope>): <subject>

type: feat, fix, perf, refactor, docs, test, chore
scope: logic, gateway, task, web, api, docs
subject: ä¸­æ–‡æè¿°ï¼Œç¥ˆä½¿è¯­æ°”

ç¤ºä¾‹ï¼š
feat(logic): å®ç°æœªè¯»æ¶ˆæ¯è®¡æ•°åŠŸèƒ½
perf(gateway): ä¼˜åŒ–ä¼šè¯åˆ—è¡¨ç¼“å­˜
governance(logic): æ¥å…¥ Prometheus ç›‘æ§
```

### Issue è§„èŒƒ

æ¯ä¸ªä¼˜åŒ–ç‚¹å¿…é¡»åŒ…å«ï¼š
1. **å…ƒä¿¡æ¯**ï¼šIDã€æ ‡é¢˜ã€ä¼˜å…ˆçº§ã€çŠ¶æ€ã€è´Ÿè´£äºº
2. **é—®é¢˜æè¿°**ï¼šå½“å‰é—®é¢˜å’Œå½±å“èŒƒå›´
3. **æ ¹å› åˆ†æ**ï¼šé—®é¢˜äº§ç”Ÿçš„æ ¹æœ¬åŸå› 
4. **è§£å†³æ–¹æ¡ˆ**ï¼šè¯¦ç»†çš„å®ç°æ–¹æ¡ˆ
5. **éªŒæ”¶æ ‡å‡†**ï¼šå®Œæˆçš„æ ‡å‡†
6. **å‚è€ƒé“¾æ¥**ï¼šç›¸å…³æ–‡æ¡£

---

## ğŸš€ å¿«é€Ÿå¼€å§‹

### 1. é€‰æ‹©ä»»åŠ¡

ä»ä¸Šè¿°è·¯çº¿å›¾æˆ– Issue åˆ—è¡¨ä¸­é€‰æ‹©ä¸€ä¸ªä»»åŠ¡ã€‚

### 2. åˆ›å»ºåˆ†æ”¯

```bash
git checkout -b feature/unread-count
```

### 3. å¼€å‘å®ç°

æŒ‰ç…§ Issue æ–‡æ¡£ä¸­çš„å®æ–½æ–¹æ¡ˆè¿›è¡Œå¼€å‘ã€‚

### 4. æµ‹è¯•éªŒè¯

```bash
# å•å…ƒæµ‹è¯•
make test

# é›†æˆæµ‹è¯•
make integration-test
```

### 5. æäº¤ PR

```bash
git add .
git commit -m "feat(logic): å®ç°æœªè¯»æ¶ˆæ¯è®¡æ•°åŠŸèƒ½"
git push origin feature/unread-count
```

---

## ğŸ“ è”ç³»æ–¹å¼

- **æŠ€æœ¯è®¨è®º**ï¼šGitHub Issues
- **æ–‡æ¡£æ›´æ–°**ï¼šæäº¤ PR åˆ° `docs/` ç›®å½•

---

## ğŸ“š å‚è€ƒèµ„æ–™

- [Genesis ç»„ä»¶æ–‡æ¡£](https://github.com/ceyewan/genesis)
- [CLAUDE.md](../CLAUDE.md) - AI åŠ©æ‰‹å·¥ä½œæŒ‡å—
- [API æ–‡æ¡£](../api/README.md)
