@tailwind base;
@tailwind components;
@tailwind utilities;

@layer base {
  :root {
    /* === Liquid Glass 配色系统 === */
    --lg-sky-400: 56 189 248;
    --lg-sky-500: 14 165 233;
    --lg-sky-600: 2 132 199;

    /* === 玻璃透明度层级 === */
    --lg-opacity-1: 0.45;
    --lg-opacity-2: 0.55;
    --lg-opacity-3: 0.68;

    /* === 玻璃背景色 RGB === */
    --lg-bg-light: 255 255 255;
    --lg-bg-dark: 15 23 42;

    /* === 模糊半径 === */
    --lg-blur-1: 16px;
    --lg-blur-2: 24px;
    --lg-blur-3: 32px;

    /* === 边框透明度 === */
    --lg-border-opacity: 0.35;

    /* === 光源模型 (135° 左上角) === */
    --lg-highlight-strong: 255 255 255;
    --lg-highlight-strong-opacity: 0.6;
    --lg-highlight-weak-opacity: 0.2;
    --lg-shadow-color: 15 23 42;
    --lg-shadow-opacity: 0.15;

    /* === 兼容旧版 === */
    --tg-accent: var(--lg-sky-500);
    --tg-accent-strong: var(--lg-sky-600);
    --app-height: 100vh;
  }

  .dark {
    --lg-bg-light: 30 41 59;
    --lg-bg-dark: 15 23 42;
    --lg-opacity-1: 0.55;
    --lg-opacity-2: 0.65;
    --lg-opacity-3: 0.75;
    --lg-border-opacity: 0.1;
    --lg-highlight-strong-opacity: 0.15;
    --lg-highlight-weak-opacity: 0.05;
    --lg-shadow-color: 0 0 0;
    --lg-shadow-opacity: 0.4;
  }

  * {
    @apply border-gray-200 dark:border-gray-700;
  }

  html {
    @apply h-full overflow-hidden;
    overscroll-behavior: none;
  }

  body {
    @apply h-full overflow-hidden font-sans text-gray-900 antialiased dark:text-gray-100;
    background:
      radial-gradient(130% 120% at 15% 10%, rgba(var(--lg-sky-500), 0.32) 0%, rgba(255, 255, 255, 0) 50%),
      radial-gradient(110% 100% at 85% 0%, rgba(var(--lg-sky-600), 0.2) 0%, rgba(255, 255, 255, 0) 42%),
      linear-gradient(160deg, #eef5ff 0%, #e6f1ff 45%, #dceeff 100%);
    background-attachment: fixed;
  }

  .dark body {
    background:
      radial-gradient(130% 120% at 10% 0%, rgba(var(--lg-sky-500), 0.22) 0%, rgba(15, 23, 42, 0) 45%),
      radial-gradient(115% 105% at 90% 0%, rgba(var(--lg-sky-600), 0.16) 0%, rgba(15, 23, 42, 0) 42%),
      linear-gradient(160deg, #0f172a 0%, #111d33 45%, #0b1220 100%);
  }

  #root {
    @apply h-full overflow-hidden;
  }

  @supports (height: 100dvh) {
    :root {
      --app-height: 100dvh;
    }
  }

  /* 滚动条 */
  ::-webkit-scrollbar {
    @apply h-2 w-2;
  }
  ::-webkit-scrollbar-track {
    @apply bg-transparent;
  }
  ::-webkit-scrollbar-thumb {
    @apply rounded-full;
    background-color: rgba(203, 213, 225, 0.8);
  }
  .dark ::-webkit-scrollbar-thumb {
    background-color: rgba(71, 85, 105, 0.8);
  }
  ::-webkit-scrollbar-thumb:hover {
    @apply bg-slate-400 dark:bg-slate-500;
  }

  /* 减弱动效 */
  @media (prefers-reduced-motion: reduce) {
    *,
    *::before,
    *::after {
      animation-duration: 0.01ms !important;
      animation-iteration-count: 1 !important;
      transition-duration: 0.01ms !important;
    }
  }
}

/* ============================================
   Liquid Glass 核心样式类
   ============================================ */

@layer components {
  /* === 基础玻璃层级 === */

  .lg-glass {
    @apply border;
    background: rgba(var(--lg-bg-light), var(--lg-opacity-1));
    backdrop-filter: blur(var(--lg-blur-1)) saturate(1.15) contrast(1.05) brightness(1.02);
    -webkit-backdrop-filter: blur(var(--lg-blur-1)) saturate(1.15) contrast(1.05) brightness(1.02);
    border-color: rgba(var(--lg-highlight-strong), var(--lg-border-opacity));
    box-shadow:
      0 20px 40px -25px rgba(var(--lg-shadow-color), var(--lg-shadow-opacity)),
      inset 0 1px 0 rgba(var(--lg-highlight-strong), var(--lg-highlight-strong-opacity)),
      inset 0 -1px 0 rgba(var(--lg-highlight-strong), var(--lg-highlight-weak-opacity));
  }

  .lg-glass-strong {
    @apply border;
    background: rgba(var(--lg-bg-light), var(--lg-opacity-2));
    backdrop-filter: blur(var(--lg-blur-2)) saturate(1.2) contrast(1.08) brightness(1.03);
    -webkit-backdrop-filter: blur(var(--lg-blur-2)) saturate(1.2) contrast(1.08) brightness(1.03);
    border-color: rgba(var(--lg-highlight-strong), calc(var(--lg-border-opacity) + 0.05));
    box-shadow:
      0 24px 48px -30px rgba(var(--lg-shadow-color), calc(var(--lg-shadow-opacity) + 0.1)),
      inset 0 1px 0 rgba(var(--lg-highlight-strong), calc(var(--lg-highlight-strong-opacity) + 0.1)),
      inset 0 -1px 0 rgba(var(--lg-highlight-strong), calc(var(--lg-highlight-weak-opacity) + 0.05));
  }

  .dark .lg-glass {
    background: rgba(var(--lg-bg-dark), var(--lg-opacity-1));
    border-color: rgba(148, 163, 184, 0.08);
    backdrop-filter: blur(18px) saturate(1.05) contrast(1.1) brightness(1.1);
    -webkit-backdrop-filter: blur(18px) saturate(1.05) contrast(1.1) brightness(1.1);
    box-shadow:
      0 24px 48px -32px rgba(0, 0, 0, 0.85),
      inset 0 1px 0 rgba(148, 163, 184, 0.15),
      inset 0 -1px 0 rgba(148, 163, 184, 0.05);
  }

  .dark .lg-glass-strong {
    background: rgba(var(--lg-bg-dark), var(--lg-opacity-2));
    border-color: rgba(148, 163, 184, 0.1);
    backdrop-filter: blur(28px) saturate(1.08) contrast(1.12) brightness(1.12);
    -webkit-backdrop-filter: blur(28px) saturate(1.08) contrast(1.12) brightness(1.12);
    box-shadow:
      0 28px 56px -36px rgba(0, 0, 0, 0.9),
      inset 0 1px 0 rgba(148, 163, 184, 0.18),
      inset 0 -1px 0 rgba(148, 163, 184, 0.08);
  }

  /* === 按钮样式 === */

  .lg-btn-primary {
    @apply rounded-2xl px-5 py-2.5 font-semibold text-white;
    background: linear-gradient(135deg, rgb(var(--lg-sky-500) / 0.95) 0%, rgb(var(--lg-sky-600) / 0.98) 100%);
    backdrop-filter: blur(8px) saturate(1.1);
    box-shadow:
      0 16px 32px -20px rgb(var(--lg-sky-600) / 0.7),
      inset 0 1px 0 rgba(255, 255, 255, 0.3),
      0 0 0 1px rgba(255, 255, 255, 0.1) inset;
    transition: all 0.25s cubic-bezier(0.4, 0, 0.2, 1);
  }

  .lg-btn-primary:hover:not(:disabled) {
    transform: translateY(-2px) scale(1.01);
    box-shadow:
      0 20px 40px -20px rgb(var(--lg-sky-600) / 0.85),
      inset 0 1px 0 rgba(255, 255, 255, 0.35),
      0 0 0 1px rgba(255, 255, 255, 0.15) inset;
  }

  .lg-btn-primary:active:not(:disabled) {
    transform: translateY(0) scale(0.98);
    box-shadow:
      0 8px 16px -12px rgb(var(--lg-sky-600) / 0.6),
      inset 0 1px 0 rgba(255, 255, 255, 0.2);
  }

  .dark .lg-btn-primary {
    background: linear-gradient(135deg, rgb(var(--lg-sky-400) / 0.9) 0%, rgb(var(--lg-sky-500) / 0.95) 100%);
    box-shadow:
      0 16px 32px -20px rgb(var(--lg-sky-500) / 0.5),
      inset 0 1px 0 rgba(255, 255, 255, 0.2),
      0 0 0 1px rgba(255, 255, 255, 0.08) inset;
  }

  .dark .lg-btn-primary:hover:not(:disabled) {
    box-shadow:
      0 20px 40px -20px rgb(var(--lg-sky-500) / 0.65),
      inset 0 1px 0 rgba(255, 255, 255, 0.25),
      0 0 0 1px rgba(255, 255, 255, 0.12) inset;
  }

  .lg-btn-secondary {
    @apply rounded-2xl px-5 py-2.5 font-semibold;
    background: rgba(255, 255, 255, 0.75);
    backdrop-filter: blur(16px) saturate(1.1);
    border: 1px solid rgba(255, 255, 255, 0.5);
    color: rgb(15, 23, 42);
    box-shadow:
      0 12px 24px -18px rgba(15, 23, 42, 0.3),
      inset 0 1px 0 rgba(255, 255, 255, 0.7);
    transition: all 0.25s cubic-bezier(0.4, 0, 0.2, 1);
  }

  .lg-btn-secondary:hover {
    background: rgba(255, 255, 255, 0.85);
    border-color: rgba(255, 255, 255, 0.6);
    transform: translateY(-1px);
    box-shadow:
      0 16px 32px -20px rgba(15, 23, 42, 0.4),
      inset 0 1px 0 rgba(255, 255, 255, 0.8);
  }

  .dark .lg-btn-secondary {
    background: rgba(30, 41, 59, 0.75);
    border-color: rgba(148, 163, 184, 0.2);
    color: rgb(241, 245, 249);
    box-shadow:
      0 12px 24px -18px rgba(0, 0, 0, 0.5),
      inset 0 1px 0 rgba(148, 163, 184, 0.15);
  }

  .dark .lg-btn-secondary:hover {
    background: rgba(30, 41, 59, 0.85);
    border-color: rgba(148, 163, 184, 0.25);
    box-shadow:
      0 16px 32px -20px rgba(0, 0, 0, 0.6),
      inset 0 1px 0 rgba(148, 163, 184, 0.2);
  }

  /* === 输入框样式 === */

  .lg-input {
    @apply rounded-2xl px-4 py-2.5;
    background: rgba(255, 255, 255, 0.85);
    backdrop-filter: blur(20px) saturate(1.05);
    -webkit-backdrop-filter: blur(20px) saturate(1.05);
    border: 1px solid rgba(71, 85, 105, 0.35);
    color: rgb(15, 23, 42);
    transition: all 0.2s ease;
    box-shadow:
      inset 0 2px 4px -2px rgba(15, 23, 42, 0.05),
      0 1px 0 rgba(255, 255, 255, 0.5) inset,
      0 0 0 1px rgba(255, 255, 255, 0.3);
  }

  .lg-input::placeholder {
    color: rgba(71, 85, 105, 0.7);
  }

  .lg-input:focus {
    background: rgba(255, 255, 255, 0.92);
    border-color: rgba(var(--lg-sky-500), 0.75);
    outline: none;
    box-shadow:
      inset 0 2px 4px -2px rgba(15, 23, 42, 0.03),
      0 0 0 3px rgba(var(--lg-sky-500), 0.22),
      0 1px 0 rgba(255, 255, 255, 0.6) inset;
  }

  .dark .lg-input {
    background: rgba(30, 41, 59, 0.75);
    border-color: rgba(148, 163, 184, 0.35);
    color: rgb(241, 245, 249);
    box-shadow:
      inset 0 2px 4px -2px rgba(0, 0, 0, 0.2),
      0 1px 0 rgba(148, 163, 184, 0.1) inset,
      0 0 0 1px rgba(15, 23, 42, 0.45);
  }

  .dark .lg-input::placeholder {
    color: rgba(148, 163, 184, 0.6);
  }

  .dark .lg-input:focus {
    background: rgba(30, 41, 59, 0.85);
    border-color: rgba(var(--lg-sky-400), 0.72);
    box-shadow:
      inset 0 2px 4px -2px rgba(0, 0, 0, 0.15),
      0 0 0 3px rgba(var(--lg-sky-400), 0.24),
      0 1px 0 rgba(148, 163, 184, 0.15) inset;
  }

  /* === 消息气泡样式 === */

  .lg-bubble-own {
    background: linear-gradient(135deg, rgb(var(--lg-sky-500) / 0.92) 0%, rgb(var(--lg-sky-600) / 0.95) 100%);
    backdrop-filter: blur(12px) saturate(1.15);
    -webkit-backdrop-filter: blur(12px) saturate(1.15);
    border: 1px solid rgba(255, 255, 255, 0.25);
    box-shadow:
      0 12px 28px -16px rgb(var(--lg-sky-600) / 0.7),
      inset 0 1px 0 rgba(255, 255, 255, 0.25),
      inset 0 -1px 0 rgba(0, 0, 0, 0.1);
  }

  .dark .lg-bubble-own {
    background: linear-gradient(135deg, rgb(var(--lg-sky-400) / 0.85) 0%, rgb(var(--lg-sky-500) / 0.9) 100%);
    border-color: rgba(255, 255, 255, 0.15);
    box-shadow:
      0 12px 28px -16px rgb(var(--lg-sky-500) / 0.5),
      inset 0 1px 0 rgba(255, 255, 255, 0.15),
      inset 0 -1px 0 rgba(0, 0, 0, 0.15);
  }

  .lg-bubble-other {
    background: rgba(255, 255, 255, 0.85);
    backdrop-filter: blur(20px) saturate(1.1) contrast(1.05);
    -webkit-backdrop-filter: blur(20px) saturate(1.1) contrast(1.05);
    border: 1px solid rgba(203, 213, 225, 0.6);
    box-shadow:
      0 10px 24px -16px rgba(15, 23, 42, 0.3),
      inset 0 1px 0 rgba(255, 255, 255, 0.8),
      inset 0 -1px 0 rgba(15, 23, 42, 0.05);
  }

  .dark .lg-bubble-other {
    background: rgba(30, 41, 59, 0.75);
    backdrop-filter: blur(20px) saturate(1.05) contrast(1.1);
    -webkit-backdrop-filter: blur(20px) saturate(1.05) contrast(1.1);
    border-color: rgba(148, 163, 184, 0.25);
    box-shadow:
      0 10px 24px -16px rgba(0, 0, 0, 0.5),
      inset 0 1px 0 rgba(148, 163, 184, 0.15),
      inset 0 -1px 0 rgba(0, 0, 0, 0.1);
  }

  .lg-bubble-system {
    background: rgba(255, 255, 255, 0.45);
    backdrop-filter: blur(16px) saturate(1.05);
    -webkit-backdrop-filter: blur(16px) saturate(1.05);
    border: 1px solid rgba(255, 255, 255, 0.3);
    color: rgba(71, 85, 105, 0.9);
  }

  .dark .lg-bubble-system {
    background: rgba(15, 23, 42, 0.6);
    border-color: rgba(148, 163, 184, 0.1);
    color: rgba(148, 163, 184, 0.8);
  }

  /* === 会话列表项样式 === */

  .lg-session-item {
    @apply mx-1.5 my-1 flex cursor-pointer items-center gap-3 rounded-2xl px-3.5 py-3;
    background: transparent;
    border: 1px solid transparent;
    transition: all 0.2s cubic-bezier(0.4, 0, 0.2, 1);
  }

  .lg-session-item:hover {
    box-shadow:
      0 10px 20px -16px rgba(15, 23, 42, 0.25),
      inset 0 1px 0 rgba(255, 255, 255, 0.3);
    transform: translateY(-1px);
  }

  .dark .lg-session-item:hover {
    box-shadow:
      0 12px 24px -18px rgba(0, 0, 0, 0.5),
      inset 0 1px 0 rgba(148, 163, 184, 0.1);
  }

  .lg-session-item:focus-visible {
    outline: 2px solid rgba(var(--lg-sky-500), 0.6);
    outline-offset: 2px;
  }

  .lg-session-item-active {
    background: linear-gradient(135deg, rgb(7 89 133 / 0.98) 0%, rgb(var(--lg-sky-600) / 0.98) 100%);
    border-color: rgba(186, 230, 253, 0.6);
    box-shadow:
      0 16px 32px -20px rgb(3 105 161 / 0.8),
      inset 0 1px 0 rgba(255, 255, 255, 0.25);
    color: rgba(255, 255, 255, 0.98);
  }

  .lg-session-item-active .lg-session-title {
    color: rgba(255, 255, 255, 0.98);
    text-shadow: 0 1px 1px rgba(2, 6, 23, 0.2);
  }

  .lg-session-item-active .lg-session-meta {
    color: rgba(240, 249, 255, 0.95);
  }

  /* === 模态框样式 === */

  .lg-modal-overlay {
    background: rgba(15, 23, 42, 0.4);
    backdrop-filter: blur(8px) saturate(1.05);
    -webkit-backdrop-filter: blur(8px) saturate(1.05);
  }

  .dark .lg-modal-overlay {
    background: rgba(0, 0, 0, 0.6);
  }

  .lg-modal-content {
    @apply lg-glass-strong;
    background: rgba(255, 255, 255, 0.85);
    border-color: rgba(255, 255, 255, 0.6);
    box-shadow:
      0 32px 64px -32px rgba(15, 23, 42, 0.5),
      inset 0 1px 0 rgba(255, 255, 255, 0.8),
      0 0 0 1px rgba(255, 255, 255, 0.2) inset;
  }

  .dark .lg-modal-content {
    background: rgba(15, 23, 42, 0.92);
    border-color: rgba(148, 163, 184, 0.2);
    box-shadow:
      0 32px 64px -32px rgba(0, 0, 0, 0.9),
      inset 0 1px 0 rgba(148, 163, 184, 0.2);
  }

  /* === 连接状态指示器 === */

  .lg-status-badge {
    @apply flex items-center gap-1.5 rounded-full border px-2.5 py-1;
    border-color: rgba(255, 255, 255, 0.45);
    background: rgba(255, 255, 255, 0.5);
    backdrop-filter: blur(12px) saturate(1.05);
    -webkit-backdrop-filter: blur(12px) saturate(1.05);
  }

  .dark .lg-status-badge {
    border-color: rgba(148, 163, 184, 0.12);
    background: rgba(15, 23, 42, 0.55);
  }

  .lg-status-dot {
    @apply h-2 w-2 rounded-full;
  }

  .lg-status-dot.connected {
    @apply bg-green-500;
    box-shadow: 0 0 10px rgba(34, 197, 94, 0.75);
  }

  .lg-status-dot.connecting {
    @apply bg-yellow-500 animate-pulse;
    box-shadow: 0 0 10px rgba(234, 179, 8, 0.75);
  }

  .lg-status-dot.disconnected {
    @apply bg-red-500;
    box-shadow: 0 0 10px rgba(239, 68, 68, 0.75);
  }

  /* === 动画效果 === */

  @keyframes lg-liquid-in {
    0% {
      opacity: 0;
      transform: scale(0.95) translateY(10px);
      filter: blur(8px);
    }
    100% {
      opacity: 1;
      transform: scale(1) translateY(0);
      filter: blur(0);
    }
  }

  .lg-animate-in {
    animation: lg-liquid-in 0.4s cubic-bezier(0.16, 1, 0.3, 1);
  }

  @keyframes lg-pulse-glow {
    0%, 100% {
      box-shadow:
        0 0 20px rgb(var(--lg-sky-500) / 0.3),
        0 0 40px rgb(var(--lg-sky-500) / 0.1);
    }
    50% {
      box-shadow:
        0 0 30px rgb(var(--lg-sky-500) / 0.5),
        0 0 60px rgb(var(--lg-sky-500) / 0.2);
    }
  }

  .lg-pulse-glow {
    animation: lg-pulse-glow 2s ease-in-out infinite;
  }

  /* === 兼容性别名 === */
  .tg-glass {
    @apply lg-glass;
  }
  .tg-glass-strong {
    @apply lg-glass-strong;
  }
  .tg-accent-btn {
    @apply lg-btn-primary;
  }
  .tg-input {
    @apply lg-input;
  }
}

/* ============================================
   backdrop-filter 降级方案
   ============================================ */

@supports not (backdrop-filter: blur(10px)) {
  .lg-glass {
    background: rgba(255, 255, 255, 0.92);
  }
  .lg-glass-strong {
    background: rgba(255, 255, 255, 0.95);
  }
  .dark .lg-glass {
    background: rgba(15, 23, 42, 0.92);
  }
  .dark .lg-glass-strong {
    background: rgba(15, 23, 42, 0.95);
  }
  .lg-bubble-own {
    background: rgb(var(--lg-sky-500));
  }
  .lg-bubble-other {
    background: rgba(255, 255, 255, 0.95);
  }
  .dark .lg-bubble-other {
    background: rgba(30, 41, 59, 0.95);
  }
  .lg-modal-content {
    background: rgba(255, 255, 255, 0.97);
  }
  .dark .lg-modal-content {
    background: rgba(15, 23, 42, 0.97);
  }
  .lg-input {
    background: rgba(255, 255, 255, 0.95);
  }
  .dark .lg-input {
    background: rgba(30, 41, 59, 0.95);
  }
}

/* ============================================
   降低透明度支持
   ============================================ */

@media (prefers-reduced-transparency: reduce) {
  .lg-glass {
    background: rgb(255, 255, 255);
    backdrop-filter: none;
    -webkit-backdrop-filter: none;
    border: 1px solid rgb(203, 213, 225);
  }
  .lg-glass-strong {
    background: rgb(255, 255, 255);
    backdrop-filter: none;
    -webkit-backdrop-filter: none;
    border: 1px solid rgb(203, 213, 225);
  }
  .dark .lg-glass,
  .dark .lg-glass-strong {
    background: rgb(15, 23, 42);
    border: 1px solid rgb(51, 65, 85);
  }
}
